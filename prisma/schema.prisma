generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum ImplementationStatus {
  NOT_PLANNED
  PLANNED
  IN_PROGRESS
  COMPLETED
  NOT_AVAILABLE
}

model Category {
  id         Int        @id @default(autoincrement())
  name       String
  note       String?    @db.VarChar(1024)
  parent_id  Int?
  parent     Category?  @relation("nestedCategories", fields: [parent_id], references: [id], onDelete: Cascade)
  categories Category[] @relation("nestedCategories")
  features   Feature[]

  @@map("categories")
}

model Product {
  id                 Int                @id @default(autoincrement())
  name               String             @unique
  note               String?            @db.VarChar(1024)
  product_features   ProductFeature[]
  product_lifecycles ProductLifecycle[]
  ContainerImage     ContainerImage[]

  @@map("products")
}

model Feature {
  id               Int              @id @default(autoincrement())
  name             String
  note             String?          @db.VarChar(1024)
  category_id      Int
  categories       Category         @relation(fields: [category_id], references: [id], onDelete: Cascade)
  product_features ProductFeature[]

  @@map("features")
}

model ProductFeature {
  id                    Int                  @id @default(autoincrement())
  product_id            Int
  feature_id            Int
  implementation_status ImplementationStatus
  release_id            Int?
  release               Release?             @relation(fields: [release_id], references: [id], onDelete: Cascade)
  dependencies          ProductFeature[]     @relation("dependencies")
  dependants            ProductFeature[]     @relation("dependencies")
  note                  String?              @db.VarChar(1024)
  product               Product              @relation(fields: [product_id], references: [id], onDelete: Cascade)
  feature               Feature              @relation(fields: [feature_id], references: [id], onDelete: Cascade)

  @@unique([product_id, feature_id])
  @@map("product_features")
}

model Release {
  id                 Int                @id @default(autoincrement())
  name               String
  date               DateTime?
  released           Boolean
  product_features   ProductFeature[]
  product_lifecycles ProductLifecycle[]

  @@map("releases")
}

enum SupportStatus {
  LONG_TERM_SUPPORT
  GENERAL_AVAILABILITY
  DEPRECATED
  END_OF_LIFE
}

model ProductLifecycle {
  release_id         Int
  container_image_id String
  support_status     SupportStatus
  release            Release        @relation(fields: [release_id], references: [id], onDelete: Cascade)
  container_image    ContainerImage @relation(fields: [container_image_id], references: [purl], onDelete: Cascade)
  Product            Product?       @relation(fields: [productId], references: [id])
  productId          Int?

  @@unique([release_id, container_image_id])
  @@map("product_lifecycles")
}

model ContainerImage {
  purl            String @id
  product_version String @db.VarChar(64)
  product_id      Int

  product          Product            @relation(fields: [product_id], references: [id], onDelete: Cascade)
  ProductLifecycle ProductLifecycle[]

  @@map("container_images")
}
