generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum ImplementationStatus {
  NOT_PLANNED
  PLANNED
  IN_PROGRESS
  COMPLETED
  NOT_AVAILABLE
}

model Category {
  id         Int        @id @default(autoincrement())
  name       String
  note       String?    @db.VarChar(1024)
  parent_id  Int?
  parent     Category?  @relation("nestedCategories", fields: [parent_id], references: [id], onDelete: Cascade)
  categories Category[] @relation("nestedCategories")
  features   Feature[]

  @@map("categories")
}

model Product {
  id               Int              @id @default(autoincrement())
  name             String           @unique
  note             String?          @db.VarChar(1024)
  product_features ProductFeature[]

  @@map("products")
}

model Feature {
  id               Int              @id @default(autoincrement())
  name             String
  note             String?          @db.VarChar(1024)
  category_id      Int
  categories       Category         @relation(fields: [category_id], references: [id], onDelete: Cascade)
  product_features ProductFeature[]

  @@map("features")
}

model ProductFeature {
  id                    Int                  @id @default(autoincrement())
  product_id            Int
  feature_id            Int
  implementation_status ImplementationStatus
  release_id            Int?
  release               Release?             @relation(fields: [release_id], references: [id], onDelete: Cascade)
  dependencies          ProductFeature[]     @relation("dependencies")
  dependants            ProductFeature[]     @relation("dependencies")
  note                  String?              @db.VarChar(1024)
  product               Product              @relation(fields: [product_id], references: [id], onDelete: Cascade)
  feature               Feature              @relation(fields: [feature_id], references: [id], onDelete: Cascade)

  @@unique([product_id, feature_id])
  @@map("product_features")
}

model Release {
  id               Int              @id @default(autoincrement())
  name             String
  date             DateTime?
  released         Boolean
  product_features ProductFeature[]

  @@map("releases")
}
